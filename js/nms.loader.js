var data = {
    Ships: {
        Starter: [
            {
                File: "/data/nms/Ships/Radiant Pillar BC1.shp",
                Name: "Radiant Pillar BC1",
                AltNames: "",
                StatImage: "/img/nms/Radiant Pillar BC1.jpg",
                Screenshot: "/img/nms/screenshots/Radiant Pillar BC1.jpg",
                Description: "NEXT starter ship. Versions 1.5 - current.",
                Missing: false
            },
            {
                Name: "Rasamama S36",
                Missing: true
            },
            {
                Name: "Yakomaku S79",
                Missing: true
            }
        ],
        PreOrder: [
            {
                File: "/data/nms/Ships/Horizon Omega.shp",
                Name: "Horizon Omega",
                AltNames: "Prime Vector, Nojose's Crystal Folly",
                StatImage: "/img/nms/Horizon Omega.jpg",
                Screenshot: "/img/nms/screenshots/Horizon Omega.jpg",
                Description: "PC preorder reward.",
                Missing: false
            },
            {
                Name: "Alpha Vector",
                Missing: true
            }
        ],
        Expeditions: [
            {
                File: "/data/nms/Ships/Golden Vector.shp",
                Name: "Golden Vector",
                AltNames: "Otanonji RL2",
                StatImage: "/img/nms/Golden Vector.jpg",
                Screenshot: "/img/nms/screenshots/Golden Vector.jpg",
                Description: "Final reward from Expedition 1: The Pioneers.",
                Missing: false
            },
            {
                File: "/data/nms/Ships/Hadach's Discovery KH3 (Expedition).shp",
                Name: "Hadach's Discovery KH3",
                AltNames: "",
                StatImage: "/img/nms/Hadach's Discovery KH3 (Expedition).jpg",
                Screenshot: "/img/nms/screenshots/Hadach's Discovery KH3.jpg",
                Description: "Phase 2 reward from Expedition 2: Beachhead.",
                Missing: false
            },
            {
                Name: "Honmatan OQ5",
                Missing: true
            }
        ],
        Twitch: [
            {
                File: "/data/nms/Ships/Eokai's Prime Inquirer.shp",
                Name: "Eokai's Prime Inquirer",
                AltNames: "Noichi's Tranquil Wings",
                StatImage: "/img/nms/Eokai's Prime Inquirer.jpg",
                Screenshot: "/img/nms/screenshots/Eokai's Prime Inquirer.jpg",
                Description: "Twitch Season 1, Day 1 drop.",
                Missing: false
            },
            {
                File: "/data/nms/Ships/Hoshis HP7.shp",
                Name: "Hoshis HP7",
                AltNames: "",
                StatImage: "/img/nms/Hoshis HP7.jpg",
                Screenshot: "/img/nms/screenshots/Hoshis HP7.jpg",
                Description: "Twitch Season 1, Day 2 drop.",
                Missing: false
            },
            {
                File: "/data/nms/Ships/Nemesis of the Kudama.shp",
                Name: "Nemesis of the Kudama",
                AltNames: "",
                StatImage: "/img/nms/Nemesis of the Kudama.jpg",
                Screenshot: "/img/nms/screenshots/Nemesis of the Kudama.jpg",
                Description: "Twitch Season 1, Day 3 drop.",
                Missing: false
            },
            {
                File: "/data/nms/Ships/Ultimate Pride JB2.shp",
                Name: "Ultimate Pride JB2",
                AltNames: "",
                StatImage: "/img/nms/Ultimate Pride JB2.jpg",
                Screenshot: "/img/nms/screenshots/Ultimate Pride JB2.jpg",
                Description: "Twitch Season 1, Day 4 drop.",
                Missing: false
            },
            {
                File: "/data/nms/Ships/Prime Song JZ4.shp",
                Name: "Prime Song JZ4",
                AltNames: "",
                StatImage: "/img/nms/Prime Song JZ4.jpg",
                Screenshot: "/img/nms/screenshots/Prime Song JZ4.jpg",
                Description: "Twitch Season 1, Day 5 drop.",
                Missing: false
            },
            {
                File: "/data/nms/Ships/VV5 Ariyaz.shp",
                Name: "VV5 Ariyaz",
                AltNames: "",
                StatImage: "/img/nms/VV5 Ariyaz.jpg",
                Screenshot: "/img/nms/screenshots/VV5 Ariyaz.jpg",
                Description: "Twitch Season 3, Day 1 drop.",
                Missing: false
            },
            {
                File: "/data/nms/Ships/Hiwamiha of Destiny.shp",
                Name: "Hiwamiha of Destiny",
                AltNames: "",
                StatImage: "/img/nms/Hiwamiha of Destiny.jpg",
                Screenshot: "/img/nms/screenshots/Hiwamiha of Destiny.jpg",
                Description: "Twitch Season 3, Day 2 drop.",
                Missing: false
            },
            {
                File: "/data/nms/Ships/Ultimate Sleep LO1.shp",
                Name: "Ultimate Sleep LO1",
                AltNames: "",
                StatImage: "/img/nms/Ultimate Sleep LO1.jpg",
                Screenshot: "/img/nms/screenshots/Ultimate Sleep LO1.jpg",
                Description: "Twitch Season 3, Day 3 drop.",
                Missing: false
            },
            {
                File: "/data/nms/Ships/Jirishi's Prospect.shp",
                Name: "Jirishi's Prospect",
                AltNames: "",
                StatImage: "/img/nms/Jirishi's Prospect.jpg",
                Screenshot: "/img/nms/screenshots/Jirishi's Prospect.jpg",
                Description: "Twitch Season 3, Day 4 drop.",
                Missing: false
            },
            {
                File: "/data/nms/Ships/Hadach's Discovery KH3 (Twitch).shp",
                Name: "Hadach's Discovery KH3",
                AltNames: "",
                StatImage: "/img/nms/Hadach's Discovery KH3 (Twitch).jpg",
                Screenshot: "/img/nms/screenshots/Hadach's Discovery KH3.jpg",
                Description: "Twitch Season 3, Day 5 drop.",
                Missing: false
            }
        ]
    },
    Multitools: {
        Starter: [
            {
                File: "/data/nms/Multitools/Waveform Focuser N56-P.mlt",
                Name: "Waveform Focuser N56-P",
                AltNames: "",
                StatImage: "/img/nms/Waveform Focuser N56-P.jpg",
                Screenshot: "",
                Description: "Starter multitool."
            }
        ],
        PreOrder: [
            {
                Name: "Rezosu Z65",
                Missing: true
            },
            {
                Name: "Artios-VI",
                Missing: true
            },
            {
                Name: "Vertic-LX",
                Missing: true
            }
        ],
        Expeditions: [
            {
                File: "/data/nms/Multitools/Geometric Dream Inverter.mlt",
                Name: "Geometric Dream Inverter",
                AltNames: "",
                StatImage: "/img/nms/Geometric Dream Inverter.jpg",
                Screenshot: "",
                Description: "Phase 5 reward from Expedition 1: The Pioneers."
            },
            {
                File: "/data/nms/Multitools/Surge of Storms B56-K1-6.mlt",
                Name: "Surge of Storms B56-K1-6",
                AltNames: "",
                StatImage: "/img/nms/Surge of Storms B56-K1-6.jpg",
                Screenshot: "",
                Description: "Phase 2 reward from Expedition 1: The Pioneers."
            }
        ],
        Twitch: [
            {
                File: "/data/nms/Multitools/Arc Capacitor W_17I-15P.mlt",
                Name: "Arc Capacitor W/17I-15P",
                AltNames: "",
                StatImage: "/img/nms/Arc Capacitor W_17I-15P.jpg",
                Screenshot: "",
                Description: "Twitch Season 1, Day 3 drop."
            },
            {
                File: "/data/nms/Multitools/Hunevar's Dream Charger.mlt",
                Name: "Hunevar's Dream Charger",
                AltNames: "",
                StatImage: "/img/nms/Hunevar's Dream Charger.jpg",
                Screenshot: "",
                Description: "Twitch Season 1, Day 4 drop."
            },
            {
                File: "/data/nms/Multitools/Imperfect Loop Reflector.mlt",
                Name: "Imperfect Loop Reflector",
                AltNames: "",
                StatImage: "/img/nms/Imperfect Loop Reflector.jpg",
                Screenshot: "",
                Description: "Twitch Season 1, Day 5 drop."
            },
            {
                File: "/data/nms/Multitools/Loop Scoop Mark IV.mlt",
                Name: "Loop Scoop Mark IV",
                AltNames: "",
                StatImage: "/img/nms/Loop Scoop Mark IV.jpg",
                Screenshot: "",
                Description: "Twitch Season 1, Day 2 drop."
            },
            {
                File: "/data/nms/Multitools/Quantum Harmoniser Mark IV.mlt",
                Name: "Quantum Harmoniser Mark IV",
                AltNames: "",
                StatImage: "/img/nms/Quantum Harmoniser Mark IV.jpg",
                Screenshot: "",
                Description: "Twitch Season 1, Day 1 drop."
            }
        ]
    },
    Companions: {
        Expeditions: [
            {
                File: "/data/nms/Companions/Burrowing Monstrosity.cmp",
                Name: "Burrowing Monstrosity",
                AltNames: "Biological Horror",
                StatImage: "/img/nms/Burrowing Monstrosity.jpg",
                Screenshot: "",
                Description: ""
            },
            {
                File: "/data/nms/Companions/D. Tempookorosa.cmp",
                Name: "D. Tempookorosa",
                AltNames: "",
                StatImage: "/img/nms/D. Tempookorosa.jpg",
                Screenshot: "",
                Description: ""
            },
            {
                File: "/data/nms/Companions/Maggotling.cmp",
                Name: "Maggotling",
                AltNames: "Hungering Worm",
                StatImage: "/img/nms/Maggotling.jpg",
                Screenshot: "",
                Description: ""
            }
        ],
        Twitch: [
            {
                File: "/data/nms/Companions/G. Oestridinzeus.cmp",
                Name: "G. Oestridinzeus",
                AltNames: "",
                StatImage: "/img/nms/G. Oestridinzeus.jpg",
                Screenshot: "",
                Description: ""
            },
            {
                File: "/data/nms/Companions/J. Croconakeum.cmp",
                Name: "J. Croconakeum",
                AltNames: "",
                StatImage: "/img/nms/J. Croconakeum.jpg",
                Screenshot: "",
                Description: ""
            },
            {
                File: "/data/nms/Companions/P. Sheptefalae.cmp",
                Name: "P. Sheptefalae",
                AltNames: "",
                StatImage: "/img/nms/P. Sheptefalae.jpg",
                Screenshot: "",
                Description: ""
            },
            {
                File: "/data/nms/Companions/V. Pentaamqum.cmp",
                Name: "V. Pentaamqum",
                AltNames: "",
                StatImage: "/img/nms/V. Pentaamqum.jpg",
                Screenshot: "",
                Description: ""
            },
            {
                File: "/data/nms/Companions/Z. Falynascria.cmp",
                Name: "Z. Falynascria",
                AltNames: "",
                StatImage: "/img/nms/Z. Falynascria.jpg",
                Screenshot: "",
                Description: ""
            }
        ]
    }
};

$(document).ready(function () {
    bindData();
});

function bindData() {
    bindShips("Starter", data.Ships.Starter);
    bindShips("PreOrder", data.Ships.PreOrder);
    bindShips("Expeditions", data.Ships.Expeditions);
    bindShips("Twitch", data.Ships.Twitch);
    bindMultitools("Starter", data.Multitools.Starter);
    bindMultitools("PreOrder", data.Multitools.PreOrder);
    bindMultitools("Expeditions", data.Multitools.Expeditions);
    bindMultitools("Twitch", data.Multitools.Twitch);
    bindCompanions("Expeditions", data.Companions.Expeditions);
    bindCompanions("Twitch", data.Companions.Twitch);
}

function bindShip(ship, container) {
    var shipName = ship.Name;
    if (ship.Missing) {
        var template = getMissing(ship.Name);
        container.append($(template));
    }
    else {
        $.getJSON(ship.File, function (shipJson) {
            var shipAltName = ship.AltNames;
            var shipStatImg = ship.StatImage;
            var shipClass = shipJson.Ship["@Cs"][";l5"]["B@N"]["1o6"];
            var shipSeed = shipJson.Ship["@Cs"]["NTx"]["@EL"][1];
            var damage = 0.0, shield = 0.0, hyperdrive = 0.0;
            var shipStats = shipJson.Ship["@Cs"][";l5"]["@bB"];
            var shipModel = shipJson.Ship["@Cs"]["NTx"]["93M"];
            var inventorySlots = shipJson.Ship["@Cs"][";l5"]["hl?"].length;
            var techSlots = shipJson.Ship["@Cs"]["PMT"]["hl?"].length;
            var shipType = "Unknown";
            switch (shipModel) {
                case "MODELS/COMMON/SPACECRAFT/FIGHTERS/FIGHTER_PROC.SCENE.MBIN":
                    shipType = "Fighter";
                    break;
                case "MODELS/COMMON/SPACECRAFT/SCIENTIFIC/SCIENTIFIC_PROC.SCENE.MBIN":
                    shipType = "Explorer";
                    break;
                case "MODELS/COMMON/SPACECRAFT/SHUTTLE/SHUTTLE_PROC.SCENE.MBIN":
                    shipType = "Shuttle";
                    break;
                case "MODELS/COMMON/SPACECRAFT/DROPSHIPS/DROPSHIP_PROC.SCENE.MBIN":
                    shipType = "Hauler";
                    break;
                case "MODELS/COMMON/SPACECRAFT/FIGHTERS/FIGHTERCLASSICGOLD.SCENE.MBIN":
                    shipType = "Unique Fighter";
                    break;
            }
            for (var stat in shipStats) {
                var statVal = shipStats[stat][">MX"]
                switch (shipStats[stat]["QL1"]) {
                    case "^SHIP_DAMAGE":
                        damage = statVal;
                        break;
                    case "^SHIP_SHIELD":
                        shield = statVal;
                        break;
                    case "^SHIP_HYPERDRIVE":
                        hyperdrive = statVal;
                        break;
                }
            }
            var table = "<table class='table table-sm m-0'>"
            table += "<tbody>";
            if (shipAltName != null && shipAltName != "") {
                table += "<tr><td>Alt Name</td><td>" + shipAltName + "</td></tr>";
            }
            table += "<tr><td>Type</td><td>" + shipType + "</td></tr>";
            table += "<tr><td>Seed</td><td>" + shipSeed + "</td></tr>";
            table += "<tr><td>Slots</td><td>" + inventorySlots + " + " + techSlots + "</td></tr>";
            table += "<tr><td>Damage Bonus</td><td>" + damage + "</td></tr>";
            table += "<tr><td>Shield Bonus</td><td>" + shield + "</td></tr>";
            table += "<tr><td>Hyperdrive Bonus</td><td>" + hyperdrive + "</td></tr>";
            table += "</tbody>";
            table += "</table>";
            var fancyId = shipClass + "_" + shipName.replace("'", "").replace("\"", "").replace(" ", "_").replace(" ", "_").replace(" ", "_").replace(" ", "_");
            var template = getCard(shipName, shipClass, ship.Description, table, shipStatImg, ship.File, ship.Screenshot, fancyId);
            container.append($(template));
        });
    }
}

function bindMultitool(multitool, container) {
    var toolName = multitool.Name;
    if (multitool.Missing) {
        var template = getMissing(toolName);
        container.append($(template));
    }
    else {
        $.getJSON(multitool.File, function (toolJson) {
            var toolAltName = multitool.AltNames;
            var toolStatImg = multitool.StatImage;
            var toolClass = toolJson.MultiTool["OsQ"]["B@N"]["1o6"];
            var toolSeed = toolJson.MultiTool["CA4"]["@EL"][1];
            var toolSlots = toolJson.MultiTool["OsQ"]["hl?"].length;
            var toolStats = toolJson.MultiTool["OsQ"]["@bB"];
            var damage = 0.0, mining = 0.0, scan = 0.0;
            for (var stat in toolStats) {
                var statVal = toolStats[stat][">MX"]
                switch (toolStats[stat]["QL1"]) {
                    case "^WEAPON_DAMAGE":
                        damage = statVal;
                        break;
                    case "^WEAPON_MINING":
                        mining = statVal;
                        break;
                    case "^WEAPON_SCAN":
                        scan = statVal;
                        break;
                }
            }
            var table = "<table class='table table-sm m-0'>"
            table += "<tbody>";
            if (toolAltName != null && toolAltName != "") {
                table += "<tr><td>Alt Name</td><td>" + toolAltName + "</td></tr>";
            }
            table += "<tr><td>Seed</td><td>" + toolSeed + "</td></tr>";
            table += "<tr><td>Slots</td><td>" + toolSlots + "</td></tr>";
            table += "<tr><td>Damage Bonus</td><td>" + damage + "</td></tr>";
            table += "<tr><td>Mining Bonus</td><td>" + mining + "</td></tr>";
            table += "<tr><td>Scanning Bonus</td><td>" + scan + "</td></tr>";
            table += "</tbody>";
            table += "</table>";

            var fancyId = toolClass + "_" + toolName.replace(" ", "_").replace("'", "").replace("\"", "");
            var template = getCard(toolName, toolClass, multitool.Description, table, toolStatImg, multitool.File, multitool.Screenshot, fancyId);
            container.append($(template));
        });
    }
}

function bindCompanion(companion, container) {
    var compName = companion.Name;
    if (companion.Missing) {
        var template = getMissing(compName);
        container.append($(template));
    }
    else {
        $.getJSON(companion.File, function (compJson) {
            var compAltName = companion.AltNames;
            var compStatImg = companion.StatImage;
            var compClass = "N";
            var compBehaviour = compJson.Companion["HbY"]["HbY"];
            var compBiome = compJson.Companion["8jm"]["8jm"];
            var compCreatureSeed = compJson.Companion["WTp"][1];
            var compCreature2ndSeed = compJson.Companion["1p="][1];
            var compSpeciesSeed = compJson.Companion["m9o"];
            var compGenusSeed = compJson.Companion["JrL"];
            var compHelpfulness = compJson.Companion["JAy"][0];
            var compGentleness = compJson.Companion["JAy"][1];
            var compIndependence = compJson.Companion["JAy"][2];
            var compType = "Unknown";
            switch (compJson.Companion["XID"]) {
                case "^FLYINGSNAKE":
                    compType = "Flying Snake";
                    break;
                case "^FIEND":
                    compType = "Fiend";
                    break;
                case "^TRICERATOPS":
                    compType = "Triceratops";
                    break;
                case "^BLOB":
                    compType = "Blob";
                    break;
                case "^LARGEBUTTERFLY":
                    compType = "Large Butterfly";
                    break;
                case "^BONECAT":
                    compType = "Bonecat";
                    break;
                case "^TREX":
                    compType = "T-Rex";
                    break;
                case "^FLYINGBEETLE":
                    compType = "Flying Beetle";
                    break;
                default:
                    break;
            }
            var table = "<table class='table table-sm m-0'>"
            table += "<tbody>";
            if (compAltName != null && compAltName != "") {
                table += "<tr><td>Alt Name</td><td>" + compAltName + "</td></tr>";
            }
            table += "<tr><td>Type</td><td>" + compType + "</td></tr>";
            table += "<tr><td>Biome</td><td>" + compBiome + "</td></tr>";
            table += "<tr><td>Behaviour</td><td>" + compBehaviour + "</td></tr>";
            table += "<tr><td>Creature Seed</td><td>" + compCreatureSeed + "</td></tr>";
            table += "<tr><td>Creature 2nd Seed</td><td>" + compCreature2ndSeed + "</td></tr>";
            table += "<tr><td>Genus Seed</td><td>" + compGenusSeed + "</td></tr>";
            table += "<tr><td>Species Seed</td><td>" + compSpeciesSeed + "</td></tr>";
            table += "<tr><td>Helpfulness</td><td>" + compHelpfulness + "</td></tr>";
            table += "<tr><td>Gentleness</td><td>" + compGentleness + "</td></tr>";
            table += "<tr><td>Independence</td><td>" + compIndependence + "</td></tr>";
            table += "</tbody>";
            table += "</table>";
            var fancyId = compClass + "_" + compName.replace(" ", "_").replace("'", "").replace("\"", "").replace(".", "");
            var template = getCard(compName, compClass, companion.Description, table, compStatImg, companion.File, companion.Screenshot, fancyId);
            container.append($(template));
        });
    }
}

var carousels = {}

function getCard(name, cl, desc, table, img, file, screen, fancyId) {
    var template = "<div class='col d-flex'>";
    template += "<div class='card mb-4 w-100'>";
    template += "<div class='card-header p-1'>";
    template += "<img src=\"/img/nms/" + cl + ".png\" height='48' class='d-inline' />";
    template += "<h4 class='d-inline'>" + name + "</h4>";
    template += "</div>";
    if ((img != null && img != "") || (screen != null && screen != "")) {
        template += "<div class='carousel slide w-100 ratio-16x9' id='" + fancyId + "' data-bs-ride='carousel'>";
        template += "<div class='carousel-inner'>";
        if (screen != null && screen != "") {
            template += "<div data-src=\"" + encodeURI(screen) + "\" data-fancybox=\"" + fancyId + "\" class='w-100 carousel-item'>"
            template += "<img src=\"" + encodeURI(screen) + "\" class='w-100' />";
            template += "</div>";
        }
        if (img != null && img != "") {
            template += "<div data-src=\"" + encodeURI(img) + "\" data-fancybox=\"" + fancyId + "\" class='w-100 carousel-item'>"
            template += "<img src=\"" + encodeURI(img) + "\" class='w-100' />";
            template += "</div>";
        }
        template += "</div>"
        template += "<button class='carousel-control-prev' type='button' data-bs-target='#" + fancyId + "' data-bs-slide='prev'>";
        template += "<span class='carousel-control-prev-icon' aria-hidden='true'></span>";
        template += "</button>";
        template += "<button class='carousel-control-next' type='button' data-bs-target='#" + fancyId + "' data-bs-slide='next'>";
        template += "<span class='carousel-control-next-icon' aria-hidden='true'></span>";
        template += "</button>"
        template += "</div>"
    }
    template += "<div class='card-body'><i>" + desc + "</i></div>";
    template += table;
    if (file != null && file != "") {
        template += "<div class='card-footer'><a href=\"" + encodeURI(file) + "\" class='btn btn-sm btn-success'><i class='fa fa-download'></i> Download</a></div>";
    }
    template += "</div>";
    template += "</div>";
    return template;
}

function getMissing(name) {
    return getCard(name, "N", "Missing.", "", "", "", "", "");
}

function bindShips(category, data) {
    var container = $("div[data-type='Ships'][data-category='" + category + "']");
    for (var ix in data) {
        var ship = data[ix];
        bindShip(ship, container);
    }
}

function bindMultitools(category, data) {
    var container = $("div[data-type='Multitools'][data-category='" + category + "']");
    for (var ix in data) {
        var multitool = data[ix];
        bindMultitool(multitool, container);
    }
}

function bindCompanions(category, data) {
    var container = $("div[data-type='Companions'][data-category='" + category + "']");
    for (var ix in data) {
        var companion = data[ix];
        bindCompanion(companion, container);
    }
}